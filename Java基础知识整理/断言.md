# 断言

在看`Objects`类的时候发现如果调用了`Objects`类的私有构造函数，将会抛出`AssertionError`异常，该类继承自`Error`，是非常严重的、不可错误的异常，开发人员需要对其进行处理。先不管这个异常是如何使用的，首先这个名字让我立即想到了“assert”这个关键字，我一直认为这是一个鸡肋，因为同样的功能使用if-else或者异常就可以代替，断言有什么用呢？

最近在看JDK源码，并且在项目中经常看到别人用断言语句，另外就是测试的时候经常用，意识到自己可能忽略了，断言是可以改善代码质量的，所以这次重新捡起来。

首先需要了解语法。

## 语法
`assert`是JDK1.4中引入的新关键字，用于在程序开发中创建“断言”。什么是断言？就是“断定会出现某种情况，如果结果非预期，那么就一定是哪里发生了错误”，它具有两种语法形式：
* assert Condition

这里的condition必须是一个结果为true的布尔表达式。它表示，“预期结果一定为真，如果预测失败了，就一定哪里出了问题”。即如果表达式为true，就是预期的值，那么什么也不做，程序该怎么走就怎么走。如果表达式的结果为false，预计失败了，那么就抛出一个`AssertionError`异常，它继承自`Error`类，属于JVM严重错误了。

* assert Condition: expr

这里的condition和上面一样，是一个预期结果为true的布尔表达式。如果预期对了，那么什么都不做；如果错了，就抛出一个`AssertionError`异常，与上面的情况不同的是，这个异常创建的时候将`expr`作为参数，值被转化为它对应的字符串，并显示出来。其他情况均相同。

根据以上的内容说明，下面是一个测试程序：
```java
public class AssertTest {

    public static void main(String[] args) {
        AssertTest test = new AssertTest();
        test.test(true);
        test.test(false);

    }

    public void test(boolean param){
        assert param;

        System.out.println("true param");
    }
}
```
【JDK1.8下】代码编译、运行都没有问题，但是执行结果为打印了两次"true param"，诶，断言语句好像没有作用。实际上，这段代码的编译和运行都有一些地方需要注意。首先，由于assert是1.4引入的，所以在编译的时候需要指定JDK为1.4之上的版本，否则编译会报错，使用的语句为`javac -source 1.4 AssertTest.java`，当然，很多IDE已经帮你选择好了JDK版本，而且现在基本上都比1.4高。另外，默认情况下，断言是关闭状态，要想使得断言语句发挥作用，需要利用语句`java -ea  AssertTest.class`来打开断言功能。所以上面这段代码的执行结果是：
```java
true param
Exception in thread "main" java.lang.AssertionError
        at AssertTest.test(AssertTest.java:18)
        at AssertTest.main(AssertTest.java:13)
```
这次终于抛出异常了。

> 一般情况下，断言是关闭状态，使用开关语句`-ae`才能打开断言功能


讲到这里，似乎明白了，断言就是来检查程序是否出错的一种手段。诶，那和异常，以及if-else有什么区别呢？

## 断言和异常的区别
在我们写程序的时候，总有一些不在设计范围之内的情况，比如，对于输入年龄，我们要求年龄是一个正整数，但是接收到的却是一个负数，这种情况到底是该用if-else来检测之后抛出异常呢还是用断言呢？


就上面这个例子来说，如果这个方法是一个public，即这个参数是外部输入的，我们无法遇到输入的值是什么，但是程序又要求对参数范围作出检查，此时我们应该对非法参数作出抛出异常的处理，而不是使用断言。因为断言是开发阶段的一种程序自检手段，在产品阶段是不起作用的，那么什么时候用断言呢？

还是上面的的例子，如果这个参数是由程序中的另一个方法传入的，而这个方法按照正常的逻辑，只有在参数检查合格了之后才能调用该方法，否则是走不到这一步的，这时候，我们可以在方法的开头进行断言。如果逻辑没错，那么断言就不会抛出`AssertionError`，如果上层逻辑错误了，在参数不合法的情况下居然调用的该方法，那么断言失败，就会产生错误。所以这是一种开发阶段调试的手段。

> 记住，断言是一种调试工具。

但是断言还是要慎用，因为一旦断言失败，程序就挂了，如果是生产环境中的应用是不能容忍的。断言的一个重要涌入就是JUnit测试程序。


## 需要注意
1. 断言是一种开发阶段的调试手段，不要出现逻辑代码
2. 默认情况下断言是关闭状态，在`java`运行命令后分别加上`-ea`和`-da`，用来开启和关闭断言。如果想要是的一个包中断言都无效，可以使用
```java
-da:com.test
```
这样就是的包`com.test`中的断言都无效。如果要是的一个包中的所有子包的断言都失效，需要在后面加上三个点，如：
```java
-da:com.test...
```
这样就使得`com.test`包及其子包中的断言都无效。

3. 断言失败抛出的`AssertionError`是继承自`Error`的，属于严重错误，不可恢复，开发者必须予以关注并解决。
4. 在对外公开的方法中，不能使用断言作为校验。因为需要遵守契约。这个例子具体可以参照https://www.cnblogs.com/DreamDrive/p/5417283.html





参考
* [Java断言机制](http://blog.csdn.net/wwj_748/article/details/8066419)
* [改善Java代码]断言绝对不是鸡肋](https://www.cnblogs.com/DreamDrive/p/5417283.html)
