# 防御式编程和契约式编程
<!--toc  -->
<!-- tocstop -->


程序的健壮性是软件成功的重要指标。为此提出了防御式编程和契约式编程的思想。

## 防御式编程
这一概念来自于防御性驾驶。在防御式驾驶中要建立这样一种思维：那就是你永远不能确定另一位司机将要做什么，你要承担起保护自己的责任，哪怕错误不是你自己产生而是由其他司机产生的，这样才能确保在其他人做出危险动作时保证你自己不会受到伤害。

所以防御式编程的主要思想是：子程序应该不因传入错误的数据被破坏，哪怕是由其他子程序产生的错误数据。更一般地说，其核心想法是要承认程序都会有问题，都需要被修改。


一般的高级程序设计语言都提供了【断言】和【异常】两种方式来进行错误处理。两者具体的实现在此略过不谈，在这里我们主要解决的问题是：两者的区别是什么？

首先【断言】是语言层次的防御式编程方法，是一种**开发阶段**使用的，让程序在运行时候进行自检的代码。用来处理**绝不应该发生**的状况，是用来检查**内部逻辑**的是否产生了错误。

举个例子：加入一个函数的参数是某数据流，这个数据流是软件下层通过读取文件传进来的，调用这个函数的时候，内部逻辑已经确定正确读取到了这个文件，否则是不会调用这个函数的。那么我们可以在这个函数的开头，对这个参数进行断言加以检查。

诶？这里有一个疑问，你不是说如果没有读到文件就不会调用这个函数呢，这时候已经调用了这个方法，那么这个参数一定是存在的，那么再进行这么一次参数检查岂不是多此一举？

话是没错，上面这个假设是建立在你的逻辑正确的情况下，要是你本身的逻辑错误怎么办？即使逻辑错误，如果发生内存的意外析构，那又怎么办？这时候函数开头的断言就很有用了，它可以用来寻找**程序逻辑的bug**。

从上面的例子很容易看出，断言是给程序员看的，用来检查内部的逻辑错误，是属于**开发阶段**的一种调试手段。为什么呢?因为默认情况下，断言是不被开启的，在产品阶段，断言是不起作用的，所以，**断言中不能出现执行代码！**

另外一种手段是【异常】，当代码出现问题时，可以通过抛出异常进行通知，如果无法处理就交给调用者进行处理。使用异常需要注意的一点是，不要过度，也不要把所有的代码都直接try-catch。一方面不好找bug，一方面降低代码性能。



## 契约式编程

“契约”就是双方约定的一些条件，作用于两方，每一方都会完成一些任务，从而促进契约的达成。同时，每一方也会接受一些义务，作为制定契约的前提，如果有一方没有尽到义务，那么契约无效。

契约式编程要求在【前提条件】、【后继条件】和【不变量条件】进行契约检查，这点和防御式编程有一点像，具体差别在哪里，目前我尚不能参透，暂且搁置。















参考
* [契约式编程与防御式编程](http://blog.jobbole.com/107939/)
* [防御式编程](https://www.cnblogs.com/HappyAngel/archive/2012/12/23/2829644.html)
